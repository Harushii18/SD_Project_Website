<div style="text-align:center">
<br></br>
<h1>Dashboard</h1>
<br></br>

  <!-- Scrollable modal -->
    <div id="summaryInfo" style="display:none;" class="modal-dialog modal-dialog-scrollable">
        <div class = "modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="modal_title">Clinical Site Information</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeModal()"></button>
          </div>
          <div id = "card_body" class="card-body">     <!-- Card body-->
            <h5 id="hosp_name" class="text-center" class="card-title"></h5>
            <p id= "hosp_loc" class="card-text"></p>
            <p id= "hosp_contact" class="card-text"></p>
            <h5 id= "hosp_capacity"></h5>
          </div>
          <div class="modal-footer">                  <!-- Modal Footer-->
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeModal()">
            Close
            </button>
          </div>
        </div>
    </div>

<script>
  var showSummary = function(hospID) {
    document.getElementById("summaryInfo").style.display = "flex";
    //document.getElementById('hosp_name').innerHTML = hospID;
    
    <% @hospitals.each do |hospital| %>
       if (hospID == "<%= hospital.id%>") {
          document.getElementById('hosp_name').innerHTML = "<%= hospital.hospital_name%>"
       }
    <%end%>


  /*
  document.getElementById("summaryInfo").style.display = "flex";
  var name = document.getElementById("hosp_table").rows[x.rowIndex].cells[0].innerHTML ;
  var location = document.getElementById("hosp_table").rows[x.rowIndex].cells[1].innerHTML;
  var contact = document.getElementById("hosp_table").rows[x.rowIndex].cells[2].innerHTML;
  var capacity = 25;
  
  document.getElementById('hosp_loc').innerHTML = location;
  document.getElementById('hosp_contact').innerHTML = "Contact: " + contact;
  document.getElementById('hosp_capacity').innerHTML = "Capacity: " + capacity + " students";
  */
  };
</script>

<script>
  function closeModal(){
  document.getElementById("summaryInfo").style.display = "none";
  }
</script>


<form action="/dashboard">
<label> <h5>Select Hospital</h5> </label>
<br>
<select name="hospital_id" id="hospital_select" onchange="showSummary(this.options[this.selectedIndex].value)" class="btn btn-primary dropdown-toggle">

</select>
</form>

<% @hospitals.each do |hospital| %>
  <script >
     select = document.getElementById('hospital_select')
     option = document.createElement( 'option' );
     option.value = <%= hospital.id %>
     option.text = "<%= hospital.hospital_name %>";
     select.add( option );
  </script>
  <br>
<%end%>



<!--The table below can be deleted after you are done with it-->
<div class="m-4">
<table class="table table-hover">
  <thead >
    <tr>
      <th scope="col"><h6>Hospital Name</h6></th>
      <th scope="col"><h6>Specialty</h6></th>
      <th scope="col"><h6>Available Slots</h6></th>
      <th scope="col"><h6>Used Slots</h6></th>


    </tr>
  </thead>

  <tbody>
    <% @hospitals.each do |hospital| %>
      <% @allocations_for_hospital = @allocations.where(:hospital_id => hospital.id) %>

      <% @allocations_for_hospital.each do |allocation_for_hospital| %>
        <% specialty_from_allocation = @specialties.find(allocation_for_hospital.specialty_id) %>
          <tr>
          <td class="col-4"><%= hospital.hospital_name %></td>
          <td class="col-4"><%= specialty_from_allocation.SpecialtyName %></td>
            
          <% @available_slots = allocation_for_hospital.available_slots %>
          <% @used_slots = allocation_for_hospital.used_slots %>

          <td class="col-1"><%= @available_slots %></td>
          <td class="col-4"><%= @used_slots %></td>
            
          </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
<div>

<br>
<br>
<br>
<br>
<br>
</div>
<!--DELETE UNTIL HERE!!=========================-->

<!--The selected hospital is a variable that stores the ID from the dropdown-->
<!--FAVOUR! CHANGE THE 1 TO THE VALUE THAT IS OBTAINED FROM THE DROPDOWN. JUST USED 1 FOR TESTING!!-->
 <% selectedHospital = 1 %>

<!--Code below does not need to be modified. Looks like it works perfectly for the one test case I tried-->
<div class="m-4">
<table class="table table-hover">
  <thead >
    <tr>
      <th scope="col"><h6>Student ID</h6></th>
      <th scope="col"><h6>Student First Name</h6></th>
      <th scope="col"><h6>Student Last Name</h6></th>
    </tr>
  </thead>
  <tbody>
 
      <!--Find the students that are at the specific hospital-->
      <% @student_details = @schedules.where(:hospital_id => selectedHospital) %>
      <% @student_details.each do |student_detail| %>
      <!--Get the student's name from the user table-->
        <% student = @users.find(student_detail.student_id) %>
          <tr>
          <td class="col-4"><%= student_detail.student_id%></td>
          <td class="col-4"><%= student.user_FirstName %></td>
          <td class="col-4"><%= student.user_LastName %></td> 
          </tr>
      <% end %>
  </tbody>
</table>
<div>



