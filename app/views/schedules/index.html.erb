


<div style="text-align:center">
<br></br>
<h1>Manage Schedules</h1>

<br>
<div class="container-fluid">
    <div class="d-flex justify-content-evenly">

    </div>
</div>

<!-- Add search forms for OWN model -->
<!-- unless statement takes out search bar when editing,creating,etc-->
<% unless url_for != users_path %>
<!--Makes the seach field neater however cant find a way to pull search field to  right of navbar -->
  <form class="form-inline my-2 my-lg-0">
      <%=render "users/filters"%>
  </form>
<% end %>
<!--ADD Below check users controller and -filters.html.erb for eg -->



<form action="/schedules">
<label> <h5>Select Programme Code</h5> </label>
<br>
<select name="programme_id" id="programme_id" onchange="this.form.submit()" class="btn btn-primary dropdown-toggle">
<%= options = options_from_collection_for_select(Programme.all, 'id', 'programme_code',@current_programme_id) %>
</select>
</form>


<!-- Some functions for the Drag and Drop Feature -->
<script>
 function drop(x){
  console.log(x);
  var data = x.dataTransfer.getData("data");
   alert(data);
 }

 function allowDrop(ev) {
  ev.preventDefault();
}

function drag(ev, specialty, duration) {

  ev.dataTransfer.setData("data", specialty);
}
</script>


<div class="m-4">


<!-- Main Table - this is the table where each row represents a single student's schedule -->
 <table id="mainTable">

 <script>
   <% @students.each do |student| %>
     //Main Table
     var mainTable = document.getElementById('mainTable');



     //STUDENT INFORMATION

     var table = document.createElement('table'); //Temporary Table element for Student information (this table is appended to the row of the main table)

     //Student Number
     var tr = document.createElement('tr'); //Table row element
     var studentNo = document.createElement('p'); //Paragraph element - for text
     var td = document.createElement('td'); //Table cell element

     //Note: This needs to be the student's name
     //This is the text for the cell
     studentNo.innerHTML = <%= student.studentNumber %>;

     td.appendChild(studentNo); //Add paragraph element to data cell element
     tr.appendChild(td); //Add data cell element to row element
     table.appendChild(tr); //Add row element to temporary table


     //For some reason, the Student Name doesn't work right now (There's a reference error)
/*
     //Student Name
     var studentName = document.createElement('p');
     var td = document.createElement('td');
     //Note: This needs to be the student's name
     studentName.innerHTML = "Student Name";
     td.appendChild(studentName);
     tr.appendChild(td);
     table.appendChild(tr);
*/

    //Create a new row element
     var tr = document.createElement('tr');
     tr.appendChild(table); //Add the temporary table to the new row element
     mainTable.appendChild(tr); //Add the new row element to the main table


     //NOTE, any other student information should appear here before the Disciplines below


     //Disciplines
     //Create a list of the specialties that this student is taking
     //Determine list of courses for student
     //Note: This method is not very efficient right now. Needs attention at some point.
     var listOfCourses = [];
     <% @programme_courses.each do |programme_course| %>
         var temp1 = <%= programme_course.programme_id %>;
         var temp2 = <%= student.programme_id %>;
         if( temp1 == temp2 ){
           listOfCourses.push(<%=programme_course.course_id%>);
         }
     <% end %>

     //Determine list of specialties based on courses the student is taking
     var listOfSpecialties = [];
     <% @course_specialties.each do |course_specialty| %>
         var temp1 = <%= course_specialty.course_id %>;
         if( listOfCourses.includes(temp1) ){
           listOfSpecialties.push(<%=course_specialty.specialty_id%>);
         }
     <% end %>


     //Dynamically create a number of Divs for the different specialties
     var table = document.createElement('table');

     //Check each specialty in database
     <% @specialties.each do |specialty| %>
         var temp1 = <%= specialty.id %>;

         //Check if student is assigned to current specialty
         if( listOfSpecialties.includes(temp1) ){
           var tr = document.createElement('tr');
           var td = document.createElement('td');
           var dis1 = document.createElement('div');


           var disName = document.createElement('p');
           specialtyName = <%=specialty.id%>
           console.log(specialtyName)
           disName.innerHTML = String(specialtyName);

           dis1.appendChild(disName);

           //Div attributes for the draggable box (to drag and drop the specialty in the timeline)
           dis1.setAttribute("id","div1");
           dis1.setAttribute("draggable","true");
           dis1.setAttribute("ondragstart","drag(event)");
           dis1.setAttribute("width","60");
           dis1.setAttribute("height","10");

           td.appendChild(dis1);
           tr.appendChild(td);

           table.appendChild(tr);
     }
     <% end %>

     var tr = document.createElement('tr');
     tr.appendChild(table);

     mainTable.appendChild(tr); //Append to main table

     //Timeline
     var tr = document.createElement('tr');

     //Some Drag Drop Functions
     function allowDrop(ev) {
         ev.preventDefault();
       }

       function drag(ev) {
         ev.dataTransfer.setData("text", ev.target.id);
       }

       function drop(ev) {
         ev.preventDefault();
         var data = ev.dataTransfer.getData("text");
         ev.target.appendChild(document.getElementById(data));

       }



     //Create 52 div blocks
     var table = document.createElement('table');
     //Create 52 div blocks
     for(let i = 1; i<=52;i++){
            var div = document.createElement('div');
            //var block = {container:div,weekNo:i};


            var text = document.createElement('p');
            //text.innerHTML = "Week " + i; //To see how many blocks are created
            div.appendChild(text);

            //Div attributes for each div block in the timeline
            div.style.width = '60px';
            div.style.height = '10px';
            div.style.padding = '10px';
            div.style.display = 'flex';

            div.style.border = "1px solid #aaaaaa";
            div.style.alignItems = 'center';

            div.setAttribute("ondrop","drop(event)")
            div.setAttribute("ondragover","allowDrop(event)")
            var td = document.createElement('td');
            td.appendChild(div);
            tr.appendChild(td);
        }
     table.appendChild(tr);
     var tr = document.createElement('tr');
     tr.appendChild(table);

     //This div holds the timeline (All 52 div blocks)
     var tempDiv = document.createElement('div');
     tempDiv.appendChild(tr);

     //Need to dynamically set the width and height in the future (So the timeline adjusts size with the window size of the browser)
     //Note: I think we need to use window.InnerWidth and window.InnerHeight here but we'll come back to this at some point.
     tempDiv.style.height = "50px";
     tempDiv.style.width = "1800px";
     tempDiv.style.overflow = 'scroll';
     tempDiv.style.alignItems = 'center';

     mainTable.appendChild(tempDiv); //Append to main table

<% end %>
 </script>

</table>



  <!---------------------------------------------------------------------------------------------->




</div>

<br>

<br>
<br>
</div>
